create or replace NONEDITIONABLE FUNCTION GET_XML_DATA (
 REPORT_DATA CLOB
) RETURN CLOB AS
 V_XML    XMLTYPE;
 V_BASE64 CLOB;
 V_POS   INTEGER := 1;
 V_CHUNK VARCHAR2(32764); --'32764/4-POWER'
 V_RAW   RAW(32767);
 V_TEXT  CLOB;
BEGIN
 V_XML := XMLTYPE(REPORT_DATA);
 SELECT
  REPORT
 INTO V_BASE64
 FROM
  XMLTABLE ( '//*[local-name()="reportBytes"]'
    PASSING V_XML
   COLUMNS
    REPORT CLOB PATH '.'
  );
  DBMS_LOB.CREATETEMPORARY(V_TEXT, TRUE);
 WHILE V_POS <= DBMS_LOB.GETLENGTH(V_BASE64) LOOP
  V_CHUNK := DBMS_LOB.SUBSTR(V_BASE64, 32764, V_POS);
  V_CHUNK := REPLACE(V_CHUNK, CHR(10), '');
  V_CHUNK := REPLACE(V_CHUNK, CHR(13), '');
  V_RAW := UTL_ENCODE.BASE64_DECODE(UTL_RAW.CAST_TO_RAW(V_CHUNK));
  
    DBMS_LOB.WRITEAPPEND(V_TEXT, UTL_RAW.LENGTH(V_RAW), UTL_RAW.CAST_TO_VARCHAR2(V_RAW));
--  DBMS_LOB.WRITEAPPEND(V_TEXT, LENGTH(UTL_RAW.CAST_TO_VARCHAR2(V_RAW)
--  ), UTL_RAW.CAST_TO_VARCHAR2(V_RAW));
  V_POS := V_POS + 32764;
 END LOOP;
 RETURN V_TEXT;
END;